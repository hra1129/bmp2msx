/**************************************************************/
// ﾀｲﾄﾙ  ：BMP to MSX
// 作者  ：HRA!
// 環境  ：Windows Vista/7/8.1
// 種別  ：フリーソフト／ツール／画像コンバータ
// 著作権：著作権は HRA! にあります
// 配布権：アーカイブをそのまま無料配布のみ許可
// URL   ：http://www5d.biglobe.ne.jp/~hra/
// 備考  ：Win95 の場合は HTML help が開ける環境に限ります
/**************************************************************/

■概要
　Windows のＢＭＰファイルをＭＳＸの BSAVE 形式の画像データへ変換
　します。

■新機能
　HISTORY.TXT をご覧ください

■機能
　入力画像形式は次の種類のみ。
　　・Windows BMP File 1bit 非圧縮
　　・Windows BMP File 4bit 非圧縮
　　・Windows BMP File 8bit 非圧縮
　　・Windows BMP File 16bit 非圧縮
　　・Windows BMP File 24bit 非圧縮
　　・Windows BMP File 32bit 非圧縮
　　・上記ファイル形式のクリップボード画像
　　・インストールした Susie PlugIn が対応する形式

　出力画像形式は次のとおりです。
　　・SCREEN2(256x192x16色)
　　・SCREEN3(64x48x16色)
　　・SCREEN5(256x212(192)x16色)
　　・SCREEN5インターレース(256x424(384)x512色中16色)
　　・SCREEN6(512x212(192)x4色)
　　・SCREEN6インターレース(512x424(384)x512色中4色)
　　・SCREEN7(512x212(192)x16色)
　　・SCREEN7インターレース(512x424(384)x512色中16色)
　　・SCREEN8(256x212(192)x固定256色)
　　・SCREEN8インターレース(256x424(384)x固定256色)
　　・SCREEN10(256x212(192)x制限付き固定12499色+512色中16色 )
　　・SCREEN10インターレース(256x424(384)x制限付き固定12499色+512色中16色 )
　　・SCREEN12(256x212(192)x制限付き固定19268色 )
　　・SCREEN12インターレース(256x424(384)x制限付き固定19268色 )
　出力ﾊﾟﾚｯﾄ形式は次の通りです。
　　・MSX-BASIC COLOR=RESTORE互換 BSAVE画像内蔵形式
　　・グラフサウルス互換 PL5/PL7 形式
　　・CSVテキスト形式

　※SCREEN10の512色中16色には対応していません。12499色のみで画像を再現します。

■操作方法
　アイコンをダブルクリックして起動してください。
　続けてSetting(メニューのSettingまたは青い部分をクリック) にて設定を行って
　ください。
　設定ダイアログをＯＫで閉じて、ＢＭＰファイルを青い部分にドラッグドロップ
　するか、File-Open のメニューで選択してください。たくさんドロップすると
　連続して変換します。
　しばらく待つと「名前を付けて保存」の画面が現れるので、ファイル名を入れて
　保存してください。（インターレースの場合は２回保存します）

　デフォルトの設定でよければ、プログラムのアイコンに直接 BMP ファイルを
　ドロップすることで変換できます。
　※デフォルトの設定は、最後に起動したときの設定です。

■設定ダイアログ
　エラー訂正アルゴリズムのところで、減色による発色の違いを目立たなくする
　ディザ画素集合の算出アルゴリズムを選択できます。
　ｴﾗｰ訂正ｱﾙｺﾞﾘｽﾞﾑの下側にある２つのスライダは、誤差拡散を選択したときに
　使われるパラメータを設定するものです。上が拡散した誤差に掛ける係数、
　下が無視する誤差の最大値。係数を大きくするとツブツブが広い範囲に広がり
　小さくするとあまり広がらなくなります。無視する誤差の最大値を大きく
　すると、ツブツブが少なくなります。怪しいアルゴリズムの誤差拡散なので
　設定がまずいと、綺麗な結果が得られないどころか、画像がぐちゃぐちゃに
　なります。

　「SCREEN xx」のオプションボタンは、排他的にマークが付きます。
　マークがついてるモード用の BSAVE ファイルを出力するようになります。

　「固定パレット」にチェックを入れると、すぐしたにあるパレットテーブル
　の色になるように減色します。パレットテーブルは、変更したい色をクリック
　して、右側のＲＧＢスライダーを使って色を変更できます。
　「固定パレット」にチェックを入れないと、減色時に自動でパレットを生成
　します。変換後、この設定ダイアログのパレットテーブルに結果が反映され
　ているので、「固定パレットチェック解除→一度変換→保存しないでキャンセル
　→パレットテーブル編集→固定パレットチェック」とすると綺麗な結果を
　得られるかもしれません (^_^;（パレットテーブルは SCREEN5/7 のときのみ
　有効）
　「固定パレット」が未チェックの場合、「多分布選色」のチェックボックスが
　有効になります。「多分布選色」未チェックの状態では、カラー分布からＲＧＢ
　もっともまんべんなく分散した色を選択します。チェックすると、最も配置量
　が多い順に１６色を選択します。通常は、未チェックの状態で使うことをおすす
　めします。SCREEN5/7 の場合のみ有効です。

　「インターレース」にチェックを入れると、インターレースモード用に
　画像を２枚出力するようになります。

　「サイズ調節」にチェックを入れると、入力画像の縦横比は維持されず、
　強制的に出力画像のサイズへ変換されます。サイズ変換時は、失われるピクセル
　の情報をなるべく保持するように処理します。
　「サイズ調節」のチェックをはずすと、そのままのサイズで変換します。
　（ただし、インターレースの場合は、幅を色平均をとりながら１／２にします）

　パレット出力のところで、パレットファイル出力形式を選択します。デフォルト
　は BSAVE内蔵形式です（※v1.0を使っていた人は注意点をご覧ください）。

　パレット読み込みボタンで、PL5/PL7 形式のパレットファイルを読み込むことが
　できます。ただし、先頭のパレット（グラフサウルスでは TR0 ）のみ読み込み
　ます。パレット以外のファイルも読み込めてしまうので注意してください。

　「ファイル名自動決定」にチェックを入れておくと、変換元ファイル名から
　自動的にファイル名を決定するようになり、変換のたびにファイル名入力の
　手間が必要なくなります。保存先フォルダは、変換元と同じ場所になります。
　自動的に作成されるファイル名は、次のように拡張子だけが変化した物になります。

　出力画面モード　｜　出力ファイルの拡張子
　−−−−−−−−＋−−−−−−−−−−−
　（ノンインターレースの場合）
　SCREEN2 　　　　｜　*.SR2 又は *.SC2(パレット内蔵)
　SCREEN3 　　　　｜　*.SR3 又は *.SC3(パレット内蔵)
　SCREEN5 　　　　｜　*.SR5 又は *.SC5(パレット内蔵)
　SCREEN7 　　　　｜　*.SR7 又は *.SC7(パレット内蔵)
　SCREEN8 　　　　｜　*.SC8
　SCREEN10/11 　　｜　*.SCA
　SCREEN12　　　　｜　*.SCC
　（インターレースの場合）
　SCREEN5 　　　　｜　*.S50 / *.S51
　SCREEN7 　　　　｜　*.S70 / *.S71
　SCREEN8 　　　　｜　*.S80 / *.S81
　SCREEN10/11 　　｜　*.SA0 / *.SA1
　SCREEN12　　　　｜　*.SC0 / *.SC1

　自動的に決定されたファイル名がすでに存在する場合は、無条件に上書きして
　しまうので注意してください。

　出力先で「プレビュー」を選択すると、ウィンドウにプレビューを表示します。
　「プレビューのみ出力」を選択すれば保存しません。保存前に変換結果を見たい
　場合に利用してください。
　プレビューメニューで、プレビューを操作することができます。プレビューは
　最大５０枚記憶しますが、「次の画像」「前の画像」で表示するプレビューを
　変更することができます。「プレビューのクリア」で表示中のプレビューを削除
　する事ができます。「プレビューの全クリア」で記憶しているプレビューを
　すべて削除することもできます。プレビューがいっぱいになると古い順に削除
　されます。「保存」では表示中のプレビューを BSAVE 形式で保存します。
　「設定を変更して再変換」では、現在のプレビューを削除して新たな設定で変換
　し直します（このときプレビューを出力しない設定にすると変換後はプレビュー
　に追加されません）。「違う設定で新しく変換」では、現在のプレビューとは無
　関係に、新たに変換し直します（このとき、プレビューを出力する設定になって
　いると、新しい画像と変換前の画像が両方プレビューに入ることになります）

　SCREEN5/7 で、「使用無許可」のチェックを入れると、現在選択中のパレット
　を使用しなくなります。使用したくないパレットにチェックを入れてください。
　ただし、最低でも２つのパレットは使用可能にしておかないと、画像は変換でき
　ません（エラーになります）。

　編集メニューの中のクリップボードから張り付けを選択すると、現在クリップ
　ボードに記憶されている画像を変換することができます（対応画像は、ＢＭＰ
　ファイルと同じ）。ただし、クリップボードからの場合は、ファイル名自動生成
　の機能が無効になり、かつプレビューからの再変換はできません。

■Susie PlugIn
　プラグインを利用するには、BMP2MSX.EXE の存在するフォルダに plugin フォルダ
　を作成して、そこに SPI ファイルを入れてください。
　プラグインは "00IN" 形式のみ対応しています。また、最大で 64種類の形式に対
　応します。
　同じ形式に対応したプラグインを入れてあると、最初に見つけた方で処理してしま
　うので注意してください。
　プラグインの認識は BMP2MSX 起動時に行われます。BMP2MSX 起動中にプラグイン
　を追加・削除した場合は、BMP2MSX を再起動してください。
　BMP読み込みプラグインが存在しても、非圧縮 BMP 形式は内蔵の処理ルーチンで
　読み込まれます。

　★絶対に BMP2MSX について Susie PlugIn 関係者の方々に問い合わせしないでく
　　ださい。

■注意点
　以前 の BMP2MSX.EXE を使用していて、それに上書きインストールした場合、
　新しく追加され機能の設定が未チェック等になります。最初の起動時に、新しく
　追加された機能の設定を確認するようにしてください。

■ファイル形式
　CSVファイルは、連続する２つのデータが１パレットになっており、パレット0
　からパレット15 まで順番に記録されています。１つのデータは１６進数であり
　最初のデータの上位４ビットが赤・下位４ビットが青、２番目のデータの下位
　４ビットが緑になっています。VDP のパレットレジスタに出力する構成になって
　いるので、アセンブラ等で利用すると便利です。

　PL5/PL7ファイルは、CSVファイルの形式をそのままバイナリで記録した物です。
　ただし、パレット0〜15 のパレット群が８個記録されています。これは、
　グラフサウルスの TR0〜TR7 に対応しています。BMPtoMSX の PL5/PL7 出力は
　TR0〜TR7 にすべて同じパレットを設定します。

■作成した画像のライセンス
　BMPtoMSX で作成した画像ファイルは、変換元の画像ファイルの著作権・肖像権
　等各権利・ライセンスをそのまま継承します。生成画像の配布・転載等に関しては
　変換元画像のライセンスに従ってください。

■配布・転載
　どんどん配布しちゃってかまいません。ただし、無料でお願いします（実費はＯＫ）。
　どこかに転載した場合は、なるべく連絡ください。インターネットのホームページ
　なら、私のホームページからのリンクも考えます。
　オリジナルのアーカイブを変更せずにそのまま配布・転載してください。

■改造
　ソースファイルを公開しています。プログラムは Windows に依存した形で書かれてい
　ます。各自にあったカスタマイズができます。
　便利な改造を施した場合は是非教えてください。一般的に有効そうな機能であれば、
　次バージョンから導入する可能性もあります。

■連絡先
　私のホームページのＭＳＸ掲示板に要望など書いてくれれば、対応するかも
　しれません。プログラミング掲示板でもかまいません。
　また、より詳細な説明書を HTML 形式で公開しています。

　ホームページURL:  http://www5d.biglobe.ne.jp/~hra/
　E-Mail :          hra@mvj.biglobe.ne.jp

■ヘルプファイル
　bmp2msx.chm ファイル（BMPtoMSXと同じ場所で公開しています）を持っている場合は
　BMP2MSX.EXE と同じフォルダに入れてください。ヘルプメニューから開けるようにな
　ります。

■Special Thanks!
　次の方々にいろいろな意見・バグ情報などを頂きました。ありがとうございます。
　　nf_ban さん
　　PP-M さん
　　まかろん さん
　　M さん
　　MZK さん
　　　　　　　　　　　　　　　　　　　　　　(C)2000-2005 製作・著作 HRA!
